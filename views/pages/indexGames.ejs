<%- include('../partials/header') %>
  <h1>
    <% if(query.length !== 0) { %>
      Showing games that has <%= query[0].searchString %> in <%= query[0].category %>
    <% } else { %>
      Showing all games
    <% } %>
  </h1>
  <main>
    <div>
      <form action="/games" method="get" class="searchbar">
        <select name="category" id="category">
          <option value="games">By game name</option>
          <% if(locals.categories) { %>
            <% categories.forEach((category) => { %>
              <option value="<%= category.table_name %>">By <%= category.col_name %></option>
            <% }) %> 
          <% } %>
        </select>
        <input type="text" name="searchString" id="searchString">
        <button>Search</button>
      </form>
    </div>
  
    <div class="container">
      <% if(locals.games) { %>
        <% games.forEach(game => { %>
          <div class="card">
              <div>
                <a href="/games/<%=game.game_id %>"><%= game.game_name %></a>
              </div>


                <div class="row">
                  <% game.categories.forEach(category => { %>
                      <% if(category.data.length !== 0) { %>
                  
                          <div>
                            <%= category.table_name.toUpperCase() %>
                            <% category.data.forEach(data => { %>
                              <div class="card-small">
                                <%= data[category.col_name + '_name'] %>
                              </div>
                            <% }) %>
                          </div>
                      <% } %>
                  
                  <% }) %>
                </div>

                <div class="row">
                  <a href="/games/<%= game.game_id %>/edit">
                    <button>Edit</button>
                  </a>
                  <button onclick="clickDeleteHandler('<%= game.game_id %>')">Delete</button>

                  <!-- <form action="/games/<%= game.game_id %>" method="POST">
                    <input type="hidden" name="_method" value="DELETE">
                    <button type="submit">Delete</button>
                  </form> -->
                </div>

          </div>
        <% }); %>
      <% } %>
    </div>
  </main>
  <script>
   async function clickDeleteHandler(id){
    console.log(id);
    let input = prompt("Enter Secret:");
    if(input){
      try{
        const response = await fetch(`/games/${id}`, {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json'
          },
          body: JSON.stringify({ userInput: input, game_id: id})
        })
      } catch (error){
        alert('Error sending data:', error);
      }
    }
   }
  </script>
<%- include('../partials/footer') %>